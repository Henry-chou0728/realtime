** 【技術報告】OpenAI 即時語音中繼伺服器系統

一、 系統核心目的本程式的主要功能是建立一個 安全中繼站 (Security Proxy)，解決 Web 端直接調用 AI 接口時最嚴重的金鑰洩露問題。傳統風險：若將 OPENAI_API_KEY 直接寫在前端 JavaScript 代碼中，任何使用者都能透過瀏覽器「檢視原始碼」功能竊取金鑰，導致點數被盜用或濫用。本系統解決方案：由後端伺服器 (FastAPI) 安全地保管永久金鑰，僅發放 「限時 1 分鐘有效」 的臨時通行證（Ephemeral Token）給前端使用者，確保系統安全且不可被非法盜用。二、 運作流程圖此架構確保了金鑰不外流，並利用 WebRTC 技術實現極低延遲的語音對話。使用者端：透過瀏覽器存取首頁路徑 (/)。前端網頁：載入後自動向後端發送請求，要求獲取短期通行證 (/session)。後端伺服器 (FastAPI)：確認請求合法性。使用內部保管的 OPENAI_API_KEY 向 OpenAI 官方 API 申請 Token。OpenAI 官方：驗證金鑰後，回傳一個具有極短時效性的 Ephemeral Session Token。前端網頁：接收 Token 後，直接與 OpenAI 伺服器建立 WebRTC 語音串流連線，開啟對話。三、 程式核心功能拆解1. 介面提供服務 (/)執行動作：從伺服器本地路徑讀取 test.html 靜態檔案。回傳格式：HTMLResponse 格式，讓瀏覽器渲染使用者介面。主要用途：提供對話介面、麥克風權限控制與 JavaScript 連線邏輯。2. 短期憑證核發服務 (/session)這是系統的核心邏輯，在申請憑證時預設了三項關鍵參數：AI 模型指定：選用 gpt-4o-mini-realtime-preview，專為即時語音優化，大幅提升反應速度。預設音色選擇：指定 marin 女聲，提供更自然、更具親和力的語音反饋。行為引導指令 (Instructions)：強制模型使用 「繁體中文（台灣用語）」 回答，確保對話口吻符合在地習慣，避免使用非慣用的專有名詞。四、 技術規格快速對照表項目詳細內容後端開發框架FastAPI (Python 3.10+)HTTP 請求庫httpx (非同步 Async 處理)通訊協定HTTP (Token 請求) / WebRTC (語音數據傳輸)安全機制金鑰不落地、核發 Ephemeral Token環境變數管理python-dotenv支援語系繁體中文（台灣習慣用語）五、 如何部署與測試運行1. 環境配置在專案根目錄建立 .env 檔案，內容如下：程式碼片段OPENAI_API_KEY=您的官方金鑰
2. 啟動服務於終端機執行以下指令啟動伺服器：Bashuvicorn main:app --reload
3. 開始測試打開瀏覽器並連線至：http://localhost:8000點擊網頁上的「開始通話」或「啟動」按鈕。允許瀏覽器使用麥克風權限。即可直接與 AI 進行流暢、低延遲的語音對話。
